<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Think & Trade — Candle Price Simulator</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9LRR1B15V7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9LRR1B15V7');
  </script>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background: linear-gradient(180deg,#f7fff7 0%, #ffffff 100%); }
    canvas { background: #0b1220; border-radius: 8px; width: 100%!important; height: auto!important; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-4">

  <!-- Header -->
  <header class="w-full max-w-4xl flex flex-col sm:flex-row items-center sm:justify-between gap-4 mb-4">
    <div class="flex items-center gap-4">
      <img src="WhatsApp Image 2025-11-20 at 02.49.45_c2297475.jpg" 
           alt="logo" 
           class="w-14 h-14 rounded-full object-cover shadow" />
      <div>
        <h1 class="text-xl sm:text-2xl font-bold">Think & Trade — Candle Price Simulator</h1>
        <p class="text-sm text-gray-600">Practice trading in a risk-free environment.</p>
      </div>
    </div>
    <div class="text-sm text-gray-700">
      <div><strong>Balance:</strong> <span id="balanceDisplay">$1000.00</span></div>
      <div><strong>Realized P/L:</strong> <span id="realizedDisplay">$0.00</span></div>
      <div><strong>Speed:</strong> <span id="speedLabel">1s</span></div>
    </div>
  </header>

  <!-- Main grid -->
  <main class="w-full max-w-4xl space-y-4">

    <!-- Chart Section -->
    <section class="bg-white p-4 rounded-lg shadow">
      <div class="flex items-center justify-between mb-3">
        <div class="text-sm text-gray-600">Simulated Market</div>
        <div class="text-sm text-gray-600">Current Price: <span id="currentPrice">--</span></div>
      </div>

      <div class="w-full overflow-hidden">
        <canvas id="chart"></canvas>
      </div>

      <div class="mt-4 flex flex-wrap gap-3">
        <button id="btnPause" class="px-4 py-2 rounded bg-yellow-400 font-semibold">Pause</button>
        <button id="btnReset" class="px-4 py-2 rounded bg-gray-200">Reset</button>

        <label class="text-sm ml-2">Candle interval:</label>
        <select id="speed" class="px-2 py-1 border rounded">
          <option value="1000">1s</option>
          <option value="700">0.7s</option>
          <option value="400">0.4s</option>
          <option value="200">0.2s</option>
          <option value="50">0.05s (fast)</option>
        </select>
      </div>
    </section>

    <!-- Controls -->
    <section class="bg-white p-4 rounded-lg shadow">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

        <div>
          <label class="block text-sm">Position Size ($):</label>
          <input id="size" type="number" value="100" min="1" class="w-full mt-1 px-3 py-2 border rounded" />
        </div>

        <div>
          <label class="block text-sm">Leverage (x):</label>
          <input id="leverage" type="number" value="1" min="1" class="w-full mt-1 px-3 py-2 border rounded" />
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 mt-4">
        <button id="btnBuy" class="flex-1 px-4 py-2 rounded bg-green-600 text-white font-bold">Buy / Long</button>
        <button id="btnSell" class="flex-1 px-4 py-2 rounded bg-red-600 text-white font-bold">Sell / Short</button>
      </div>

      <button id="btnClose" class="w-full px-4 py-2 mt-3 rounded bg-indigo-600 text-white font-bold">
        Close Position
      </button>

      <div class="pt-4 border-t mt-4">
        <div class="text-sm text-gray-600 mb-2">Position</div>
        <div><strong>Type:</strong> <span id="posType">None</span></div>
        <div><strong>Size ($):</strong> <span id="posSize">0</span></div>
        <div><strong>Entry Price:</strong> <span id="posEntry">-</span></div>
        <div><strong>Unrealized P/L:</strong> <span id="unreal">0</span></div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="mt-4 text-sm text-gray-600 max-w-4xl text-center">
    Mobile-optimized trading simulator — practice anywhere.
  </footer>

  <!-- SCRIPT -->
  <script>
    const canvas = document.getElementById('chart');
    const ctx = canvas.getContext('2d');

    const currentPriceEl = document.getElementById('currentPrice');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const realizedDisplay = document.getElementById('realizedDisplay');
    const posTypeEl = document.getElementById('posType');
    const posSizeEl = document.getElementById('posSize');
    const posEntryEl = document.getElementById('posEntry');
    const unrealEl = document.getElementById('unreal');
    const sizeInput = document.getElementById('size');
    const levInput = document.getElementById('leverage');
    const speedSelect = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');

    let candles = [];
    let maxCandles = 80;
    let lastClose = 100;

    let balance = 1000;
    let realized = 0;

    let position = null;
    let running = true;
    let timer = null;

    function resizeCanvas() {
      canvas.width = canvas.parentElement.clientWidth;
      canvas.height = 300; 
      drawChart();
    }

    window.addEventListener("resize", resizeCanvas);
    setTimeout(resizeCanvas, 100);

    function drawChart() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "#0b1220";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      if (candles.length === 0) return;

      const h = canvas.height;
      const w = canvas.width;
      const candleWidth = w / maxCandles;

      const prices = candles.flatMap(c => [c.h, c.l]);
      const maxP = Math.max(...prices);
      const minP = Math.min(...prices);
      const range = maxP - minP || 1;

      const scaleY = p => h - ((p - minP) / range) * (h - 10);

      candles.forEach((c, i) => {
        const x = i * candleWidth;
        const yOpen = scaleY(c.o);
        const yClose = scaleY(c.c);
        const yHigh = scaleY(c.h);
        const yLow = scaleY(c.l);

        ctx.strokeStyle = "white";
        ctx.beginPath();
        ctx.moveTo(x + candleWidth / 2, yHigh);
        ctx.lineTo(x + candleWidth / 2, yLow);
        ctx.stroke();

        const isBull = c.c >= c.o;
        ctx.fillStyle = isBull ? "#10b981" : "#ef4444";
        ctx.fillRect(x + 1, Math.min(yOpen, yClose), candleWidth - 2, Math.abs(yClose - yOpen));
      });

      currentPriceEl.textContent = lastClose.toFixed(2);
    }

    function nextCandle() {
      const move = (Math.random() - 0.5) * 1.2;
      const open = lastClose;
      const close = Math.max(0.1, open + move);
      const high = Math.max(open, close) + Math.random() * 0.6;
      const low = Math.min(open, close) - Math.random() * 0.6;

      candles.push({o:open, h:high, l:low, c:close});
      if (candles.length > maxCandles) candles.shift();

      lastClose = close;
      drawChart();
      updateUnrealized();
    }

    function startLoop() {
      if (timer) clearInterval(timer);
      const interval = Number(speedSelect.value);
      speedLabel.textContent = interval >= 1000 ? (interval/1000)+"s" : interval+"ms";
      timer = setInterval(() => { if (running) nextCandle(); }, interval);
    }

    function openPosition(type) {
      if (position) return alert("Close your current position first.");

      const size = Number(sizeInput.value);
      const lev = Number(levInput.value);

      position = { type, size, lev, entry: lastClose };

      posTypeEl.textContent = type;
      posSizeEl.textContent = "$" + size;
      posEntryEl.textContent = position.entry.toFixed(2);
    }

    function closePosition() {
      if (!position) return;

      const change = (lastClose - position.entry) / position.entry;
      const pnl = (position.type === "long" ? change : -change) * position.size * position.lev;

      balance += pnl;
      realized += pnl;

      balanceDisplay.textContent = "$" + balance.toFixed(2);
      realizedDisplay.textContent = "$" + realized.toFixed(2);

      position = null;
      posTypeEl.textContent = "None";
      posSizeEl.textContent = "0";
      posEntryEl.textContent = "-";
      unrealEl.textContent = "0";
    }

    function updateUnrealized() {
      if (!position) return unrealEl.textContent = "0";

      const change = (lastClose - position.entry) / position.entry;
      const pnl = (position.type === "long" ? change : -change) * position.size * position.lev;

      unrealEl.textContent = (pnl>=0?"+":"") + "$" + pnl.toFixed(2);
    }

    document.getElementById("btnBuy").onclick = () => openPosition("long");
    document.getElementById("btnSell").onclick = () => openPosition("short");
    document.getElementById("btnClose").onclick = closePosition;

    document.getElementById("btnPause").onclick = () => {
      running = !running;
      document.getElementById("btnPause").textContent = running ? "Pause" : "Resume";
    };

    document.getElementById("btnReset").onclick = () => {
      if (!confirm("Reset simulation?")) return;

      candles = [];
      lastClose = 100;
      balance = 1000;
      realized = 0;

      position = null;
      posTypeEl.textContent = "None";
      posSizeEl.textContent = "0";
      posEntryEl.textContent = "-";
      unrealEl.textContent = "0";

      balanceDisplay.textContent = "$1000.00";
      realizedDisplay.textContent = "$0.00";

      resizeCanvas();
    };

    speedSelect.onchange = startLoop;

    resizeCanvas();
    startLoop();
  </script>
</body>
</html>
